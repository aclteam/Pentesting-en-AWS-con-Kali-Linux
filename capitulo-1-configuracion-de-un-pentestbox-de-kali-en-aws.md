# Capítulo 1: Configuración de un PentestBox de Kali en AWS

## Hardening e instalación de Guacamole

Actualizamos la lista de paquetes disponibles de los repositorios de Kali

```bash
sudo apt update
```

Clonamos el script de instalación de Guacamole

```bash
git clone https://github.com/MysticRyuujin/guac-install.git /tmp/guac-install
```

Accedemos a la carpeta temporal y ejecutamos el script

```bash
cd /tmp/guac-install
```

```bash
sudo ./guac-install.sh --nomfa --installmysql --mysqlpwd P4ssw0rdS3gUr4 --guacpwd 0tr4P4ssw0rdS3gUr4
```

Comprobamos el estado de los servicios recien instalados

```bash
systemctl status tomcat9 guacd mysql
```

Editamos el archivo de configuración del servidor de Tomcat y cambiamos el puerto del conector a **55555**

```bash
sudo nano /etc/tomcat9/server.xml
```

```bash
<Connector port="55555" protocol="HTTP/1.1"
           connectionTimeOut="20000"
           redirectPort="8443">
```

Reiniciamos el servicio de **Tomcat**

```bash
sudo service tomcat9 restart
```

Instalamos **xrdp**

```bash
sudo apt install xrdp
```

Editamos el archivo de configuración

```bash
sudo nano /etc/X11/Xwrapper.config
```

Cambiamos el valor

```bash
allowed_users=anybody
```

Habilitamos los servicios y configuramos el inicio de estos

```bash
sudo update-rc.d xrdp enable
```

```bash
sudo systemctl enable xrdp-sesman.service
```

```bash
sudo service xrdp start
```

```bash
sudo service xrdp-sesman start
```

