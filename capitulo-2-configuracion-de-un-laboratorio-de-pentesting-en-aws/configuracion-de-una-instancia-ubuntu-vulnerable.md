# Configuración de una instancia Ubuntu vulnerable

## Lanzamiento de una instancia de Ubuntu vulnerable

Nos conectamos a la instancia de Ubuntu

```
ssh -i <archivo pem> ubuntu@<DNS de IPv4 pública>
```

Actualizamos el listado del repositorio y todos los paquetes instalados

```bash
sudo apt update && sudo apt dist-upgrade
```

## Instalación de un servicio FTP vulnerable

Clonamos el repositorio

```bash
git clone https://github.com/nikdubois/vsftpd-2.3.4-infected.git
```

Instalamos el paquete

```bash
sudo apt install build-essential
```

Entramos a la carpeta

```bash
cd vsftpd-2.3.4-infected
```

Editamos el archivo **Makefile**

```bash
nano Makefile
```

Añadimos el valor -**lcrypt**

```bash
# Makefile for systems with GNU tools
CC      =       gcc
INSTALL =       install
IFLAGS  = -idirafter dummyinc
#CFLAGS = -g
CFLAGS  =       -O2 -Wall -W -Wshadow #-pedantic -Werror -Wconversion

LIBS    =       `./vsf_findlibs.sh`
LINK    =       -Wl,-s,-lcrypt
…
```

Ejecutamos el comando **make**

```bash
make
```

Comprobamos la creación del binario

```bash
ls -l vsftpd
```

Añadimos un usuario y creamos una carpeta

```bash
useradd nobody
```

```bash
sudo mkdir /usr/share/empty
```

Llevamos a cabo la instalación

```bash
sudo cp vsftpd /usr/local/sbin/vsftpd
```

```bash
sudo cp vsftpd.8 /usr/local/man/man8
```

```bash
sudo cp vsftpd.conf.5 /usr/local/man/man5
```

```bash
sudo cp vsftpd.conf /etc
```

Ejecutamos el servicio vsftpd y comprobamos la conexión

```bash
sudo /usr/local/sbin/vsftpd &
```

```bash
ftp localhost
```

Configuramos el acceso anónimo al servidor

```bash
sudo mkdir /var/ftp
```

```bash
sudo useradd -d /var/ftp ftp
```

```bash
sudo chown root:root /var/ftp
```

```bash
sudo chmod go-w /var/ftp
```

Habilitamos el inicio de sesión local en vsftpd

```bash
sudo nano /etc/vsftpd.conf
```

```bash
…
# Uncomment this to allow local users to log in
local_enable=YES
…
```



